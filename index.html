<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Gleitzeit-Test pur</title>
</head>
<body>
  <h2>Gleitzeit Debug</h2>
  <label>Monatliches Soll: <input type="number" id="soll" value="184"></label>
  <button onclick="saveSoll()">OK</button>
  <button onclick="add()">Nachtrag Tag</button>
  <button onclick="reset()">Reset</button>
  <ul id="list"></ul>
  <div id="sum"></div>
  <div id="diff"></div>
  <script>
    function fmt(min) {
      let h = Math.floor(min/60), m = min%60;
      return h.toString().padStart(2,'0')+':'+m.toString().padStart(2,'0');
    }
    function saveSoll() {
      let v=+document.getElementById("soll").value;
      localStorage.setItem("soll", v);
      show();
    }
    function add() {
      let d=prompt("Datum (YYYY-MM-DD)");
      if(!d) return;
      let h=prompt("Netto-Stunden (HH:MM)");
      if(!h) return;
      let [hh,mm]=h.split(":").map(Number);
      let data = JSON.parse(localStorage.getItem("tage") || "{}");
      data[d] = hh*60+mm;
      localStorage.setItem("tage", JSON.stringify(data));
      show();
    }
    function reset() {
      if(confirm("Alles lÃ¶schen?")) {
        localStorage.removeItem("tage");
        show();
      }
    }
    function show() {
      let soll = +localStorage.getItem("soll") || 184;
      document.getElementById("soll").value = soll;
      let data = JSON.parse(localStorage.getItem("tage") || "{}");
      let sum = 0, items = [];
      Object.keys(data).sort().forEach(k => {
        sum += data[k];
        items.push(`<li>${k}: ${fmt(data[k])}</li>`);
      });
      document.getElementById("list").innerHTML = items.join("");
      document.getElementById("sum").innerHTML = `Gearbeitet: <b>${fmt(sum)}</b>`;
      document.getElementById("diff").innerHTML = `Differenz zu Soll: <b>${fmt(sum-soll*60)}</b>`;
    }
    if(!localStorage.getItem("soll")) localStorage.setItem("soll", 184);
    show();
  </script>
</body>
</html>
